###-----------LOADING AND MANIPULATING DATA -----------------###

## Install required libraries (Since you have a new computer)
if (!requireNamespace("dplyr", quietly = TRUE)) install("dplyr")
if (!requireNamespace("tidyverse", quietly = TRUE)) install("tidyverse")

#load your packages you installed
library(dplyr)
library(tidyverse)

#Read in your .csv file
#obviously change this to your 'filepath'
gene_data <- background_gene_dat <- read.csv("C:\\Users\\drive\\projects\\subfolder\\path\\to\\file.csv")

#add a column (mutate) called 'diffexpressed' that will assign that the gene is either UP or DOWN based on the l2fc value
#then filter differentially expressed genes
gene_data_filtered <- gene_data %>%
  mutate(diffexpressed = case_when(
    log2FoldChange > 1 ~ "UP", 
    #log2FoldChange > 1 & padj < 0.05 ~ "UP", # use this line IF you want to filter for genes where BOTH their l2fc > 1 AND padj are > 0.05
    log2FoldChange < -1 ~ "DOWN", 
    #log2FoldChange < -1 & padj < 0.05 ~ "DOWN", # use this line IF you want to filter for genes where BOTH their l2fc < 1 AND padj are > 0.05
    TRUE ~ "NEUTRAL")) %>% # For genes that do not meet these criteria
  filter(diffexpressed %in% c("UP", "DOWN"))  #from your new column 'diffexpressed', filter for ONLY genes that are differntially expressed according to your thresholds

#if you only want to select for COLUMNS that have, for example, the header 'diffexpressed', 'log2FoldChange', 'and 'padj' or 'function'
gene_data_filtered <- gene_data_filtered %>%
  select(c(diffexpressed, log2FoldChange, padj, function)) #replace any of these with exactly what your column header is

###-----------GENERATING PUBLICATION-FORMATTED TABLES-----------------###
#optional if you want to do this instead of exporting data into an excel file
if (!requireNamespace("modelsummary", quietly = TRUE)) install("modelsummary")
library(modelsummary)
 # https://modelsummary.com/vignettes/datasummary.html if you need it

differential_genes_table <- datasummary_skim(gene_data_filtered)
print(differential_genes_table)
